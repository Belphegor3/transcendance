{% extends 'base.html' %}

{% load static %}
{% load i18n %}

{% block title %}
    Sign Up
{% endblock %}

{% block extra_styles %}
<link href="{% static 'css/home.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center vh-100">
    <div id="signup-card" class="card m-3">
        <div class="card-body">
            <h2 id="sign-up" class="card-title text-center">{% trans 'Sign Up' %}</h2>

            <form id="signupForm" method="POST" action="{% url 'signup' %}">
                {% csrf_token %}

				<div class="mb-3">
					<div class="form-group">
						<div class="input-group">
							{{ form.username }}
							<span class="input-group-text" data-toggle="tooltip" title="{% trans '150 characters or fewer. Letters, digits and @/./+/-/_ only.' %}">
								<i class="fas fa-question-circle"></i>
							</span>
						</div>
					</div>
				</div>

				<div class="mb-3">
					<div class="form-group">
						{{ form.email }}
					</div>
				</div>

				<div class="mb-3">
					<div class="form-group">
						{{ form.password }}
					</div>
				</div>
            </form>

				<div class="d-flex justify-content-between mb-3">
					<a id="already-have-account" class="text-primary" onclick="navigateTo(event, '{% url 'home' %}')">
						{% trans "Already have an account?" %}
					</a>
				</div>
                <div class="d-flex justify-content-between mb-3">
                    <button id="register" type="submit" class="btn btn-primary" onclick="navigateTo(event, '{% url 'realhome' %}')">{% trans 'Register' %}</button>
                    <button id="back-home" class="btn btn-dark" onclick="navigateTo(event, '/')">
                        {% trans 'Back home' %}
                    </button>
                </div>
        </div>
    </div>
</div>

<script>
	$(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();
    });

	document.getElementById('signupForm').addEventListener('submit', function(event) {
		event.preventDefault();

		const formData = new FormData(this);

		fetch('/register', {
			method: 'POST',
			body: formData,
		})
		.then(response => response.json())
		.then(data => {
			if (data.status === 'success') {
				alert('Registration successful!');
				navigateTo('/');
			} else {
				alert('Error: ' + data.message);
			}
		})
		.catch(error => console.warn('Error: [', error, ']'));
	});

	function navigateTo(url) {
		window.history.pushState({}, '', url);
		fetch(url)
			.then(response => response.text())
			.then(html => {
				document.body.innerHTML = html;
			})
			.catch(error => console.warn('Error: [', error, ']'));
	}

	window.onpopstate = function() {
		fetch(window.location.href)
			.then(response => response.text())
			.then(html => {
				document.body.innerHTML = html;
			});
	};
</script>
{% endblock %}
